!function(e,t){"use strict";e.MetaCAPIPixel={debug:!1,init:function(e){this.debug=e.debug||!1,this.log("Meta CAPI Pixel Helper initialized",e)},generateEventID:function(e,t,i){return void 0===i&&(i=!0),e=e+"_"+t,i&&(e+="_"+Date.now()),this.log("Generated Event ID",{eventType:e,identifier:t,eventID:e}),e},track:function(e,t,i){if(void 0===fbq)return this.log("Meta Pixel not loaded, skipping event",{eventName:e},"warn"),!1;try{return fbq("track",e,t,{eventID:i}),this.log("Event tracked",{eventName:e,eventData:t,eventID:i}),!0}catch(o){return this.log("Error tracking event",{eventName:e,error:o.message},"error"),!1}},getPixelCookies:function(){var e={fbp:this.getCookie("_fbp"),fbc:this.getCookie("_fbc")};if(!e.fbc){var t=this.getUrlParameter("fbclid");t&&(e.fbc="fb.1."+Date.now()+"."+t)}return this.log("Retrieved pixel cookies",e),e},getCookie:function(e){var t="; "+t.cookie,i=t.split("; "+e+"=");if(2===i.length)return i.pop().split(";").shift();return null},getUrlParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?null:decodeURIComponent(t[1].replace(/\+/g," "))},storeEventID:function(e,i){if(void 0===sessionStorage)return void this.log("SessionStorage not available",null,"warn");try{var o={eventID:e,eventData:i,timestamp:Date.now()};sessionStorage.setItem("meta_capi_"+e,JSON.stringify(o)),this.log("Event ID stored",o)}catch(n){this.log("Error storing event ID",{error:n.message},"error")}},getStoredEventID:function(e,i){if(void 0===sessionStorage)return null;void 0===i&&(i=!0);try{var o="meta_capi_"+e,n=sessionStorage.getItem(o);if(n)return n=JSON.parse(n),i&&sessionStorage.removeItem(o),this.log("Event ID retrieved",n),n}catch(r){this.log("Error retrieving event ID",{error:r.message},"error")}return null},sendToServer:function(e,t,i){if(void 0===meta_capi_ajax||!meta_capi_ajax.ajax_url)return void this.log("AJAX URL not defined",null,"error");var o={action:e,nonce:meta_capi_ajax.nonce};for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);this.log("Sending data to server",{action:e,data:o});var r=new XMLHttpRequest;r.open("POST",meta_capi_ajax.ajax_url,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onload=function(){if(r.status>=200&&r.status<300){var e={};try{e=JSON.parse(r.responseText)}catch(t){e={success:!1,error:"Invalid JSON response"}}MetaCAPIPixel.log("Server response received",e),"function"==typeof i&&i(e)}else MetaCAPIPixel.log("Server request failed",{status:r.status},"error")},r.onerror=function(){MetaCAPIPixel.log("Network error",null,"error")};for(var a=[],n in o)o.hasOwnProperty(n)&&a.push(encodeURIComponent(n)+"="+encodeURIComponent(o[n]));r.send(a.join("&"))},log:function(e,i,o){if(this.debug&&(o=o||"log",console&&console[o]))if(i)console[o]("[Meta CAPI Pixel]",e,i);else console[o]("[Meta CAPI Pixel]",e)}},void 0!==meta_capi_config&&e.MetaCAPIPixel.init(meta_capi_config)}(window,document);

