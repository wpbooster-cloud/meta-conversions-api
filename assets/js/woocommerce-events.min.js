!function(t){"use strict";t(document).ready(function(){if("undefined"==typeof fbq)return void console.warn("Meta CAPI: Facebook Pixel (fbq) not loaded. WooCommerce events will not be tracked.");const e={init:function(){this.trackViewContent(),this.trackAddToCart(),this.trackInitiateCheckout(),this.trackPurchase()},generateEventId:function(t,e=""){const n=Date.now(),o=Math.random().toString(36).substring(2,15);return t+"_"+e+"_"+n+"_"+o},trackViewContent:function(){if("undefined"==typeof metaCAPIWooCommerceData||!metaCAPIWooCommerceData.is_product)return;const t=metaCAPIWooCommerceData.product;if(!t)return;const e=this.generateEventId("ViewContent",t.id);fbq("track","ViewContent",{content_ids:[t.id],content_name:t.name,content_type:"product",content_category:t.category||"",value:t.price,currency:t.currency},{eventID:e}),console.log("Meta CAPI: ViewContent event tracked",{product_id:t.id,event_id:e})},trackAddToCart:function(){const e=this;t(document.body).on("added_to_cart",function(n,o,a,c){const r=c.data("product_id"),i=c.data("quantity")||1;let s={id:r,name:c.data("product_name")||c.attr("aria-label")||"Product",price:parseFloat(c.data("product_price"))||0,quantity:i};"undefined"!=typeof metaCAPIWooCommerceData&&metaCAPIWooCommerceData.product&&(s=metaCAPIWooCommerceData.product,s.quantity=i);const d=e.generateEventId("AddToCart",r);fbq("track","AddToCart",{content_ids:[s.id],content_name:s.name,content_type:"product",value:s.price*i,currency:s.currency||metaCAPIWooCommerceData.currency},{eventID:d}),console.log("Meta CAPI: AddToCart event tracked (AJAX)",{product_id:r,quantity:i,event_id:d})}),t("form.cart").on("submit",function(){if("undefined"==typeof metaCAPIWooCommerceData||!metaCAPIWooCommerceData.product)return;const n=metaCAPIWooCommerceData.product,o=t(this).find('input[name="quantity"]'),a=o.length?parseInt(o.val()):1,c=e.generateEventId("AddToCart",n.id);fbq("track","AddToCart",{content_ids:[n.id],content_name:n.name,content_type:"product",value:n.price*a,currency:n.currency},{eventID:c}),console.log("Meta CAPI: AddToCart event tracked (Form)",{product_id:n.id,quantity:a,event_id:c})})},trackInitiateCheckout:function(){if("undefined"==typeof metaCAPIWooCommerceData||!metaCAPIWooCommerceData.is_checkout)return;const t=metaCAPIWooCommerceData.cart;if(!t)return;const e=this.generateEventId("InitiateCheckout");fbq("track","InitiateCheckout",{content_ids:t.content_ids||[],contents:t.contents||[],content_type:"product",value:t.value||0,currency:t.currency,num_items:t.num_items||0},{eventID:e}),console.log("Meta CAPI: InitiateCheckout event tracked",{value:t.value,num_items:t.num_items,event_id:e})},trackPurchase:function(){if("undefined"==typeof metaCAPIWooCommerceData||!metaCAPIWooCommerceData.is_order_received)return;const t=metaCAPIWooCommerceData.order;if(!t||!t.id)return;const e="purchase_"+t.id;fbq("track","Purchase",{content_ids:t.content_ids||[],contents:t.contents||[],content_type:"product",value:t.value||0,currency:t.currency,num_items:t.num_items||0},{eventID:e}),console.log("Meta CAPI: Purchase event tracked",{order_id:t.id,value:t.value,event_id:e})}};e.init()})}(jQuery);
